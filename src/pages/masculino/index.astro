---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import MatchCard from '../../components/MatchCard.astro';
import PhotoGallery from '../../components/PhotoGallery.astro';
import StandingsTable from '../../components/StandingsTable.astro';
import TopScorersTable from '../../components/TopScorersTable.astro'; 
import TeamBadge from '../../components/TeamBadge.astro';

// Importar datos din√°micos
import masculinoData from '../../data/masculino.json';
import masculinoImages from '../../data/masculino-images.json';

// Obtener todas las fases disponibles y ordenarlas por fecha (descendente) para mostrar la m√°s reciente primero
const phases = masculinoData.phases || [];

// Helper: parse Spanish date strings like '22 de octubre' or '26 de octubre' or '2025-10-22'
function parseSpanishDate(dateStr?: string) {
  if (!dateStr) return 0;
  // Try ISO first
  const iso = Date.parse(dateStr);
  if (!Number.isNaN(iso)) return iso;

  // Spanish month names map
  const months: Record<string, number> = {
    'enero': 0, 'febrero': 1, 'marzo': 2, 'abril': 3,
    'mayo': 4, 'junio': 5, 'julio': 6, 'agosto': 7,
    'septiembre': 8, 'setiembre': 8, 'octubre': 9, 'noviembre': 10, 'diciembre': 11
  };

  // Extract numbers/words
  const normalized = dateStr.toLowerCase().replace(',', '').trim();
  // Examples: '22 de octubre' or '26 de octubre 2025' or '2025-10-22'
  const parts = normalized.split(' ');
  // Find day (first numeric token)
  const dayToken = parts.find(p => /\d{1,2}/.test(p));
  const dayNum = dayToken ? Number(dayToken.replace(/\D/g, '')) : NaN;
  // find month token
  const monthToken = parts.find(p => Object.prototype.hasOwnProperty.call(months, p));
  const month = monthToken ? months[monthToken] : undefined;
  // find year token
  const yearToken = parts.find(p => /^\d{4}$/.test(p));
  const year = yearToken ? Number(yearToken) : 2025; // default 2025
  if (!Number.isFinite(dayNum) || month === undefined) return 0;
  return new Date(year, month, dayNum).getTime();
}

// Now sort phases by parsed date descending
const phasesSorted = [...phases].sort((a, b) => parseSpanishDate(b.date) - parseSpanishDate(a.date));
const currentPhase = phasesSorted[0] || phases[phases.length - 1];
const cloudBase = 'https://res.cloudinary.com/dny2fuvgi/image/upload';
const teamsA = [
  { name: 'Panteras', city: 'Pasto', img: `${cloudBase}/v1763848624/Imagen2_p8xmps.webp` },
  { name: 'Wasps', city: 'Sibundoy', img: `${cloudBase}/v1763848236/logoWasps_hcnejv.webp` },
  { name: 'Atenas', city: 'Contadero', img: `${cloudBase}/v1763848623/Imagen6_hf87r7.webp` },
];
const teamsB = [
  { name: 'Berchos', city: 'Pasto', img: `${cloudBase}/v1763848625/Imagen4_q7h4xc.webp` },
  { name: 'Javeriano', city: 'Sibundoy', img: `${cloudBase}/v1763848623/Imagen1_fddlhp.webp` },
  { name: 'S&C', city: 'Contadero', img: `${cloudBase}/v1763848623/SyC_q1ptqn.webp` },
];
const getImagesFor = (idOrName: string) => {
  const phase = phases.find(p => p.id === idOrName || p.name === idOrName) as any;
  if (phase?.images?.length) return phase.images;
  const normalize = (s?: string) => s?.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9\-]/g, '');
  const key = normalize(idOrName) || normalize(phase?.id) || normalize(phase?.name);
  return (key && (masculinoImages as any)[key]) || undefined;
};
// Mapa de logos por nombre de equipo (puedes agregar m√°s entradas seg√∫n necesites)
const logos = Object.fromEntries([...teamsA, ...teamsB].map(t => [t.name, t.img]));
---

<BaseLayout title="Categor√≠a Masculina - Baby Baloncesto 2025">
  <Header />

  <!-- Hero Section Masculino -->
  <section class="bg-gradient-to-br from-masculino/20 via-masculino/10 to-white py-20 court-lines">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <div class="mb-8 justify-center flex">
      <img src="https://res.cloudinary.com/dny2fuvgi/image/upload/v1763854337/logoBabybaloncesto_rhwin8.webp" alt="Logotipo de Baby Baloncesto ‚Äî Nari√±o y Putumayo 2025" class="h-36 w-auto" loading="lazy">
      </div>
      
      <h1 class="text-4xl md:text-6xl font-black text-dark-gray mb-4">
        CATEGOR√çA <span class="text-masculino">MASCULINA</span>
      </h1>
      <p class="text-xl text-gray-700 mb-8">
        Municipio de Puerres 2025
      </p>

      <!-- Quick Stats -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-6 max-w-4xl mx-auto">
        <div class="bg-white/60 backdrop-blur rounded-2xl p-4 shadow-lg">
          <div class="text-2xl font-black text-masculino">6</div>
          <div class="text-sm font-semibold text-gray-700">Equipos</div>
        </div>
        <div class="bg-white/60 backdrop-blur rounded-2xl p-4 shadow-lg">
          <div class="text-2xl font-black text-masculino">2</div>
          <div class="text-sm font-semibold text-gray-700">Grupos</div>
        </div>
        <div class="bg-white/60 backdrop-blur rounded-2xl p-4 shadow-lg">
          <div class="text-2xl font-black text-masculino">5</div>
          <div class="text-sm font-semibold text-gray-700">D√≠as</div>
        </div>
        <div class="bg-white/60 backdrop-blur rounded-2xl p-4 shadow-lg">
          <div class="text-2xl font-black text-masculino">15</div>
          <div class="text-sm font-semibold text-gray-700">Partidos</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Navigation Phases -->
  <section class="bg-white py-8 sticky top-20 z-40 shadow-lg">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <nav class="flex flex-wrap justify-center gap-4">
        <a href="#grupos" class="bg-masculino/10 text-masculino px-4 py-2 rounded-full font-semibold hover:bg-masculino hover:text-white transition-all">Grupos</a>
        <a href="#tablas" class="bg-gray-100 text-gray-700 px-4 py-2 rounded-full font-semibold hover:bg-masculino hover:text-white transition-all">Tablas</a>
        <a href="#primera-fecha" class="bg-gray-100 text-gray-700 px-4 py-2 rounded-full font-semibold hover:bg-masculino hover:text-white transition-all">Primera Fecha</a>
        <a href="#segunda-fecha" class="bg-gray-100 text-gray-700 px-4 py-2 rounded-full font-semibold hover:bg-masculino hover:text-white transition-all">Segunda Fecha</a>
        <a href="#tercera-fecha" class="bg-gray-100 text-gray-700 px-4 py-2 rounded-full font-semibold hover:bg-masculino hover:text-white transition-all">Tercera Fecha</a>
        <a href="#semifinal" class="bg-gray-100 text-gray-700 px-4 py-2 rounded-full font-semibold hover:bg-masculino hover:text-white transition-all">Semifinal</a>
        <a href="#final" class="bg-gray-100 text-gray-700 px-4 py-2 rounded-full font-semibold hover:bg-masculino hover:text-white transition-all">Final</a>
      </nav>
    </div>
  </section>

  <!-- Tabla de Grupos -->
  <section id="grupos" class="py-16 bg-gradient-to-r from-masculino/5 to-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <h2 class="text-3xl md:text-4xl font-black text-center mb-12 text-dark-gray">
        TABLA DE <span class="text-masculino">GRUPOS</span>
      </h2>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Grupo A -->
        <div class="bg-white rounded-3xl shadow-xl overflow-hidden">
          <div class="bg-masculino text-white p-4 text-center">
            <h3 class="text-2xl font-bold">GRUPO A</h3>
          </div>
<div class="p-6 space-y-4">
  {teamsA.map((team) => (
    <div class="flex items-center justify-between p-3 bg-masculino/5 rounded-xl">
      <TeamBadge name={team.name} img={team.img} size="md" />
      <span class="text-sm text-gray-600 ml-4 hidden sm:inline">{team.city}</span>
    </div>
  ))}
</div>
        </div>

        <!-- Grupo B -->
        <div class="bg-white rounded-3xl shadow-xl overflow-hidden">
          <div class="bg-masculino text-white p-4 text-center">
            <h3 class="text-2xl font-bold">GRUPO B</h3>
          </div>
<div class="p-6 space-y-4">
  {teamsB.map((team) => (
    <div class="flex items-center justify-between p-3 bg-masculino/5 rounded-xl">
      <TeamBadge name={team.name} img={team.img} size="md" />
      <span class="text-sm text-gray-600 ml-4 hidden sm:inline">{team.city}</span>
    </div>
  ))}
</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Tablas de Estad√≠sticas -->
  <section id="tablas" class="py-16 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <h2 class="text-3xl md:text-4xl font-black text-center mb-12 text-dark-gray">
        ESTAD√çSTICA
      </h2>

      <!-- Selector de Fases -->
      <div class="flex justify-center mb-8">
        <div class="bg-white rounded-2xl shadow-lg p-2 flex flex-wrap gap-2">
            {phasesSorted.map((phase: any, index: number) => (
            <button 
              class={`px-4 py-2 rounded-xl font-semibold transition-all phase-selector ${
                index === 0 ? 'bg-masculino text-white' : 'text-gray-600 hover:bg-masculino/10'
              }`}
              data-phase={phase.id}
            >
              {phase.name}
            </button>
          ))}
        </div>
      </div>

      <div class="space-y-12">
          {phasesSorted.map((phase: any, index: number) => (
          <div 
            class={`phase-content ${index === 0 ? '' : 'hidden'}`}
            data-phase={phase.id}
          >
            <!-- Tabla de Posiciones -->
            <div class="mb-12">
              <StandingsTable 
                standings={phase.standings}
                category="masculino"
                phase={phase.name}
                logos={logos}
              />
            </div>

            <!-- Tablas en Grid -->
            <div class="grid grid-cols-1 lg:grid-cols-1 gap-8">
              <!-- Fair Play -->
{/*               <div>
                <FairPlayTable 
                  fairPlay={phase.fair_play}
                  category="masculino"
                  phase={phase.name}
                  logos={logos}
                />
              </div> */}

              <!-- Top Scorers -->
              <div>
                <TopScorersTable 
                  topScorers={phase.top_scorers}
                  category="masculino"
                  phase={phase.name}
                  logos={logos}
                />
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Primera Fecha -->
  <section id="primera-fecha" class="py-16 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <h2 class="text-3xl md:text-4xl font-black text-center mb-4 text-dark-gray">
        PRIMERA <span class="text-masculino">FECHA</span>
      </h2>
      <p class="text-center text-lg text-gray-600 mb-12">Mi√©rcoles, 22 de Octubre</p>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div class="space-y-6">
          <h3 class="text-2xl font-bold text-masculino mb-6">Partidos</h3>
          <MatchCard 
            time="4:00 PM" 
            team1=" Panteras - Pasto"
            team2="Wasps - Sibundoy"
            result1={22}
            result2={52}
            group="A"
            category="masculino"
            logos={logos}
          />
          <MatchCard 
            time="5:00 PM" 
            team1="Berchos - Pasto"
            team2="Javeriano - Pasto"
            result1={46}
            result2={27}
            group="B"
            category="masculino"
            logos={logos}
          />
          <MatchCard 
            time="6:00 PM" 
            team1=" Atenas - Contadero"
            team2=" S&C - Ipiales"
            result1={23}
            result2={18}
            group="A vs B"
            category="masculino"
            logos={logos}
          />
        </div>

        <div>
          <PhotoGallery 
            phase="Primera Fecha"
            category="masculino"
            id="masculino-primera"
            images={getImagesFor('primera-fecha')}
          />
        </div>
      </div>
    </div>
  </section>

  <!-- Segunda Fecha -->
  <section id="segunda-fecha" class="py-16 bg-masculino/5">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <h2 class="text-3xl md:text-4xl font-black text-center mb-4 text-dark-gray">
        SEGUNDA <span class="text-masculino">FECHA</span>
      </h2>
      <p class="text-center text-lg text-gray-600 mb-12">Jueves, 23 de Octubre</p>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div class="space-y-6">
          <h3 class="text-2xl font-bold text-masculino mb-6">Partidos</h3>
          <MatchCard 
            time="4:00 PM" 
            team1="Berchos - Pasto"
            team2=" S&C - Ipiales"
            result1={51}
            result2={11}
            group="B"
            category="masculino"
            logos={logos}
          />
          <MatchCard 
            time="5:00 PM" 
            team1=" Panteras - Pasto"
            team2=" Atenas - Contadero"
            result1={28}
            result2={27}
            group="A"
            category="masculino"
            logos={logos}
          />
          <MatchCard 
            time="6:00 PM" 
            team1="Wasps - Sibundoy"
            team2="Javeriano - Pasto"
            result1={38}
            result2={8}
            group="A vs B"
            category="masculino"
            logos={logos}
          />
        </div>

        <div>
          <PhotoGallery 
            phase="Segunda Fecha"
            category="masculino"
            id="masculino-segunda"
            images={getImagesFor('segunda-fecha')}
          />
        </div>
      </div>
    </div>
  </section>

  <!-- Tercera Fecha -->
  <section id="tercera-fecha" class="py-16 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <h2 class="text-3xl md:text-4xl font-black text-center mb-4 text-dark-gray">
        TERCERA <span class="text-masculino">FECHA</span>
      </h2>
      <p class="text-center text-lg text-gray-600 mb-12">Viernes, 24 de Octubre</p>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div class="space-y-6">
          <h3 class="text-2xl font-bold text-masculino mb-6">Partidos</h3>
          <MatchCard 
            time="4:00 PM" 
            team1="Wasps - Sibundoy"
            team2=" Atenas - Contadero"
            result1={52}
            result2={28}
            group="A"
            category="masculino"
            logos={logos}
          />
          <MatchCard 
            time="5:00 PM" 
            team1="Javeriano - Pasto"
            team2=" S&C - Ipiales"
            result1={35}
            result2={18}
            group="B"
            category="masculino"
            logos={logos}
          />
          <MatchCard 
            time="6:00 PM" 
            team1=" Panteras - Pasto"
            team2="Berchos - Pasto"
            result1={18}
            result2={49}
            group="A vs B"
            category="masculino"
            logos={logos}
          />
        </div>

        <div>
          <PhotoGallery 
            phase="Tercera Fecha"
            category="masculino"
            id="masculino-tercera"
            images={getImagesFor('tercera-fecha')}
          />
        </div>
      </div>
    </div>
  </section>

  <!-- Semifinal -->
  <section id="semifinal" class="py-16 bg-gradient-to-r from-masculino/10 to-masculino/5">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <h2 class="text-3xl md:text-4xl font-black text-center mb-4 text-dark-gray">
        <span class="text-masculino">SEMIFINAL</span>
      </h2>
      <p class="text-center text-lg text-gray-600 mb-4">S√°bado, 25 de Octubre</p>
      <p class="text-center text-sm text-gray-600 mb-12">Clasifican los 2 primeros de cada grupo</p>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div class="space-y-6">
          <h3 class="text-2xl font-bold text-masculino mb-6">Partidos</h3>
          <MatchCard 
            time="2:00 PM" 
            team1="Wasps - Sibundoy"
            team2="Javeriano - Pasto"
            result1={43}
            result2={18}
            group="S1"
            category="masculino"
            logos={logos}
          />
          <MatchCard 
            time="3:00 PM" 
            team1="Berchos - Pasto"
            team2=" Panteras - Pasto"
            result1={42}
            result2={13}
            group="S2"
            category="masculino"
            logos={logos}
          />
        </div>

        <div>
          <PhotoGallery 
            phase="Semifinal"
            category="masculino"
            id="masculino-semifinal"
            images={getImagesFor('semifinal')}
          />
        </div>
      </div>
    </div>
  </section>

  <!-- Final -->
  <section id="final" class="py-16 bg-gradient-to-br from-masculino/20 via-masculino/10 to-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <h2 class="text-3xl md:text-4xl font-black text-center mb-4 text-dark-gray">
        GRAN <span class="text-masculino">FINAL</span>
      </h2>
      <p class="text-center text-lg text-gray-600 mb-12">Domingo, 26 de Octubre</p>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div class="space-y-6">
          <h3 class="text-2xl font-bold text-masculino mb-6">Partidos Finales</h3>
          
          <div class="bg-white/80 backdrop-blur rounded-2xl p-6 shadow-xl">
            <h4 class="text-lg font-bold text-gray-700 mb-4">3er y 4to Puesto</h4>
            <MatchCard 
              time="26 de octubre"
              team1="Javeriano - Pasto"
              team2=" Panteras - Pasto"
              result1={38}
              result2={25}
              category="masculino"
              logos={logos}
            />
          </div>

          <div class="bg-gradient-to-r from-masculino/20 to-masculino/10 rounded-2xl p-6 shadow-xl border-2 border-masculino/30">
            <h4 class="text-lg font-bold text-masculino mb-4 flex items-center space-x-2">
              <span>üèÜ</span>
              <span>1er y 2do Puesto</span>
            </h4>
            <MatchCard 
              time="26 de octubre"
              team1="Wasps - Sibundoy"
              team2="Berchos - Pasto"
              result1={32}
              result2={16}
              category="masculino"
              logos={logos}
            />
          </div>
        </div>

        <div>
          <PhotoGallery 
            phase="Final"
            category="masculino"
            id="masculino-final"
            images={getImagesFor('final')}
          />
        </div>
      </div>
    </div>
  </section>

  <Footer />
</BaseLayout>